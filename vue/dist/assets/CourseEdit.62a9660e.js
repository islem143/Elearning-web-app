import{_ as y,r as _,o as n,c,F as g,j as I,a as o,t as f,I as C,i as v,b as m,w as F,f as w,g as h,h as k}from"./index.ae1caef1.js";import{u as M,r as $}from"./index.esm.19565990.js";import{Q as x}from"./QuizForm.6a90dc02.js";const U={name:"CourseUpload",props:{media:{type:Array},courseId:{type:String}},data(){return{selectedFiles:void 0,progressInfos:[],message:"",fileInfos:[]}},methods:{selectFile(e){this.selectedFiles=e.files},uploader(){this.$emit("upload-files",this.selectedFiles)},uploadFiles(){this.message="";for(let e=0;e<this.selectedFiles.length;e++)this.upload(e,this.selectedFiles[e])},upload(e,t){this.progressInfos[e]={percentage:0,fileName:t.name},UploadService.upload(t,{courseId:this.courseId},"/api/media",s=>{this.progressInfos[e].percentage=Math.round(100*s.loaded/s.total)}).then(s=>{let d=this.message?this.message+`
`:"";this.message=d+s.data.message})}}},V={key:0},S={class:"progress"},j=["aria-valuenow"],z={class:"card relative surface-300 field mt-3"},A=o("h5",null,"Attachement",-1),B={key:0},D=o("p",null,"Drag and drop files to here to upload.",-1);function N(e,t,s,d,i,a){const u=_("FileUpload");return n(),c(g,null,[i.progressInfos?(n(),c("div",V,[(n(!0),c(g,null,I(i.progressInfos,(r,p)=>(n(),c("div",{class:"mb-2",key:p},[o("span",null,f(r.fileName),1),o("div",S,[o("div",{class:"progress-bar progress-bar-info",role:"progressbar","aria-valuenow":r.percentage,"aria-valuemin":"0","aria-valuemax":"100",style:C({width:r.percentage+"%"})},f(r.percentage)+"% ",13,j)])]))),128))])):v("",!0),o("div",z,[A,m(u,{name:"demo[]",customUpload:!0,onSelect:a.selectFile,onUploader:a.uploader,multiple:!0},{content:F(({uploadedFiles:r,progress:p})=>[r&&r[0]?(n(),c("ul",B,[w(" ds "),(n(!0),c(g,null,I(r[0],l=>(n(),c("li",{key:l},f(l.name)+" - "+f(l.size)+" bytes ",1))),128))])):v("",!0)]),empty:F(()=>[D]),_:1},8,["onSelect","onUploader"])])],64)}const T=y(U,[["render",N]]),b={image:["png","jpeg","jpg"],file:["pdf","ppt","doc","docx"],video:["mp4"]};class Q{upload(t,s,d,i){let a=new FormData,u="file",r=t.name.split(".")[1];for(const p in b)if(b[p].includes(r)){u=p;break}a.append("file",t),a.append("type",u);for(const p in s)a.append(p,s[p]);return h.post(d,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:i})}}const E=new Q,q={name:"CourseForm",components:{UploadMedia:T,QuizForm:x},created(){let e=parseInt(this.$route.params.moduleId),t=parseInt(this.$route.params.courseId);this.moduleId=e,this.courseId=t,this.courseId&&h.get("/api/module/"+this.moduleId+"/course/"+this.courseId).then(s=>{this.info.title=s.data.title,this.info.description=s.data.description,this.media=s.data.media})},setup(){return{v$:M()}},data(){return{modukeId:null,courseId:null,info:{title:"",description:""},media:[],mediaList:[],types:["file","image","video"]}},validations(){return{info:{title:{required:$},description:{required:$}}}},methods:{async deleteMedia(e){let t=await h.delete("/api/media/"+e.id),s=this.media.findIndex(d=>d.id==e.id);this.media.splice(s,1),console.log(t),this.$toast.add({severity:"success",summary:t.data.message,life:3e3})},addContent(e){this.courseId&&h.post("/api/module/"+this.moduleId+"/course/"+this.courseId+"/content",{content:e}).then(t=>{console.log("yes")})},removeMediaFeild(e){this.media.splice(e,1)},createQuiz(){if(!this.courseId){this.$toast.add({severity:"warn",summary:"Please create the course first.",life:3e3});return}this.$router.push({name:"quiz-create",params:{courseId:this.courseId}})},addMediaField(){let e=new Object;this.media.push(e)},errorMessages(e){const t=[];if(!this.v$.goal[e].$dirty)return t;for(const s of this.v$.goal[e].$errors)t.push(s.$message);return t},async getMedia(){let e=await h.get("/api/media/"+parseInt(this.courseId));this.media=e.data},async uploadFiles(e,t){for(const s of e)await E.upload(s,{courseId:t},"/api/media",d=>{this.$toast.add({severity:"success",summary:"Files were uploaded.",life:3e3})})},async upload(e){let t=this.courseId?this.courseId:null;t||(t=await this.submit(!0)),await this.uploadFiles(e,t),this.getMedia()},async submit(e,t){if(await this.v$.$validate())if(this.courseId)await h.put("/api/module/"+this.moduleId+"/course/"+this.courseId,this.info),this.$toast.add({severity:"success",summary:"Course Updated",life:3e3});else return await h.post("/api/module/"+this.moduleId+"/course",this.info).then(d=>{const i=d.data.id;if(t)return i;this.$router.push({name:"module-detail",params:{moduleId:this.moduleId}})}).catch(d=>{console.log(d)})}}},L={class:"card p-fluid"},R=o("h4",null,"Add Course",-1),O={class:"flex justify-content-center"},P={class:"w-6 mt-5"},G={class:"field"},H=o("label",{for:"name1"},"Title",-1),J={class:"field"},K=o("label",{for:"Description"},"Description",-1),W=o("h4",null,"Media:",-1),X={class:"mt-2"},Y=["href"],Z={key:0};function ee(e,t,s,d,i,a){const u=_("Button"),r=_("InputText"),p=_("UploadMedia");return n(),c("div",L,[R,m(u,{label:"Add Quiz",class:"w-1",onClick:a.createQuiz},null,8,["onClick"]),o("div",O,[o("div",P,[o("div",G,[H,m(r,{modelValue:i.info.title,"onUpdate:modelValue":t[0]||(t[0]=l=>i.info.title=l),type:"text"},null,8,["modelValue"])]),o("div",J,[K,m(r,{modelValue:i.info.description,"onUpdate:modelValue":t[1]||(t[1]=l=>i.info.description=l),type:"text"},null,8,["modelValue"])]),m(u,{class:"mt-5",onClick:a.submit,label:"Submit"},null,8,["onClick"]),W,o("div",X,[(n(!0),c(g,null,I(i.media,l=>(n(),c("div",{key:l.id,class:"flex justify-content-between align-items-center p-card mb-2 p-2"},[o("a",{class:"block",href:"http://localhost:8081/"+l.url},f(l.name),9,Y),m(u,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:ie=>a.deleteMedia(l)},null,8,["onClick"])]))),128))]),i.media.length==0?(n(),c("p",Z,"There are no media for this course.")):v("",!0),m(p,{up:"",onUploadFiles:a.upload,onRemoveMediaField:a.removeMediaFeild,onAddMediaField:a.addMediaField,media:i.media},null,8,["onUploadFiles","onRemoveMediaField","onAddMediaField","media"])])])])}const te=y(q,[["render",ee]]),se={name:"CourseEdit",components:{CourseFormVue:te}};function oe(e,t,s,d,i,a){const u=_("CourseFormVue");return n(),k(u)}const le=y(se,[["render",oe]]);export{le as default};
